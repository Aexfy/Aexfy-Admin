<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aexfy Admin - Vendedor</title>
  <link rel="icon" href="../../PNG Logo ico.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/app.css">
</head>
<body data-access="owner,manager,supervisor,seller">
  <div id="global-loading" class="global-loading">
    <div class="spinner"></div>
    <div id="global-loading-text">Cargando...</div>
  </div>

  <div id="app-shell" class="app-layout">
    <aside class="sidebar">
      <div class="sidebar-header">
        <img class="sidebar-logo" src="../../PNG Logo nombre.png" alt="Aexfy">
        <div class="sidebar-title">Aexfy Admin</div>
      </div>
      <nav class="sidebar-nav">
        <a class="nav-link" href="panel.html" data-view="panel">Panel</a>
        <a class="nav-link" href="superusuario.html" data-view="superusuario" data-role-required="owner,manager">Superusuario</a>
        <a class="nav-link" href="empresas.html" data-view="empresas" data-role-required="owner,manager,supervisor">Empresas</a>
        <a class="nav-link" href="usuarios.html" data-view="usuarios" data-role-required="owner,manager,hr,supervisor">Usuarios</a>
        <a class="nav-link" href="staff.html" data-view="staff" data-role-required="owner,manager,hr">Staff</a>
        <a class="nav-link" href="modulos.html" data-view="modulos" data-role-required="owner,manager">Modulos</a>
        <a class="nav-link" href="suscripcion.html" data-view="suscripcion" data-role-required="owner,manager">Suscripcion</a>
        <a class="nav-link" href="soporte.html" data-view="soporte" data-role-required="owner,manager,support">Soporte</a>
        <a class="nav-link" href="auditoria.html" data-view="auditoria" data-role-required="owner,manager,support">Auditoria</a>
        <a class="nav-link" href="analitica.html" data-view="analitica" data-role-required="owner,manager,supervisor">Analitica</a>
        <a class="nav-link" href="dte.html" data-view="dte" data-role-required="owner,manager,supervisor,seller">DTE</a>
        <a class="nav-link" href="vendedor.html" data-view="vendedor" data-role-required="owner,manager,supervisor,seller">Vendedor</a>
      </nav>
      <div class="sidebar-footer">Clientes asignados</div>
    </aside>

    <main class="main-content">
      <header class="topbar">
        <h1 id="view-title">Vendedor</h1>
        <div class="topbar-actions">
          <div class="session-info">
            <strong id="session-email">-</strong>
            <span id="session-role">-</span>
          </div>
          <button id="logout-btn" class="btn btn-outline btn-sm">Salir</button>
        </div>
      </header>

      <section class="content-area" id="vendedor-content">
        <div class="module-header">
          <div>
            <h2>Panel vendedor</h2>
            <p class="text-muted">Lista de clientes asignados.</p>
          </div>
          <div class="module-header-actions">
            <button id="seller-create-company" class="btn btn-primary">Crear empresa</button>
          </div>
        </div>

        <div id="seller-assign-section" class="card">
          <h3>Asignar vendedor a empresa</h3>
          <form id="seller-assign-form" class="grid-2" style="margin-top: 12px;">
            <div class="form-group">
              <label>Empresa</label>
              <select id="seller-company-select" required></select>
            </div>
            <div class="form-group">
              <label>Email vendedor</label>
              <input id="seller-email" type="email" placeholder="seller@Aexfy.cl" required>
            </div>
            <div class="form-group" style="align-self: end;">
              <button class="btn btn-primary" type="submit">Asignar</button>
            </div>
          </form>
        </div>

        <div id="seller-clients-list"></div>
      </section>
    </main>
  </div>

  <script src="../js/config.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../js/supabase.js"></script>
  <script src="../js/core.js"></script>
  <script src="../js/ui.js"></script>
  <script src="../js/auth.js"></script>
  <script src="../js/companies.js"></script>
  <script src="../js/users.js"></script>
  <script src="../js/staff.js"></script>
  <script src="../js/modules.js"></script>
  <script src="../js/subscription.js"></script>
  <script src="../js/support.js"></script>
  <script src="../js/analytics.js"></script>
  <script src="../js/audit.js"></script>
  <template id="company-form-template">
    <form id="company-form">
      <input type="hidden" name="id">
      <div class="form-group">
        <label>Razon social</label>
        <input type="text" name="name" required>
      </div>
      <div class="grid-2">
        <div class="form-group">
          <label>RUT</label>
          <input type="text" name="rut" maxlength="12" placeholder="11.222.333-4" required>
        </div>
        <div class="form-group">
          <label>Giro</label>
          <input type="text" name="giro" required>
        </div>
      </div>
      <div class="grid-2">
        <div class="form-group">
          <label>Actividad economica / codigo SII</label>
          <input type="text" name="actividad_economica" required>
        </div>
        <div class="form-group">
          <label>Email tributario</label>
          <input type="email" name="email_tributario" required>
        </div>
      </div>
      <div class="grid-2">
        <div class="form-group">
          <label>Telefono</label>
          <input type="text" name="telefono" placeholder="+56 9 1234 5678">
        </div>
        <div class="form-group">
          <label>Region</label>
          <input type="text" name="region" required>
        </div>
      </div>
      <div class="grid-2">
        <div class="form-group">
          <label>Ciudad</label>
          <input type="text" name="ciudad" required>
        </div>
        <div class="form-group">
          <label>Comuna</label>
          <input type="text" name="comuna" required>
        </div>
      </div>
      <div class="form-group">
        <label>Direccion</label>
        <input type="text" name="direccion" required>
      </div>
      <div class="error-message" data-form-error></div>
      <div class="form-group">
        <label>Plan</label>
        <select name="plan">
          <option value="starter">Starter</option>
          <option value="growth">Growth</option>
          <option value="enterprise">Enterprise</option>
        </select>
      </div>
      <div class="form-group">
        <label>Estado</label>
        <select name="status">
          <option value="active">Activo</option>
          <option value="pending">Pendiente</option>
          <option value="blocked">Bloqueado</option>
        </select>
      </div>
      <div class="form-group">
        <label>Owner email</label>
        <input type="email" name="owner_email" required>
      </div>
      <div class="form-group">
        <label>Vendedor asignado</label>
        <input type="email" name="seller_email" readonly>
      </div>
      <div class="form-group">
        <label>Modulos activos</label>
        <div data-modules class="modules-grid"></div>
      </div>
    </form>
  </template>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-OdT+RB2kz9cnqyma1r1IBW4W7w9YQ6Q2GiG6XIraB5H2Z4C3KZ0qFgzvdCG1u3M6YFJ99HyMaWI01gD4lMv2R0g==" crossorigin="anonymous"></script>
  <script src="../js/vendedor.js"></script>
  <script src="../js/dte.js"></script>
  <script src="../js/password.js"></script>
  <script src="../js/app.js"></script>
  <script>
    (function() {
      var button = document.getElementById('seller-create-company');
      if (!button) return;

      function bindButton() {
        var companies = window.Aexfy && window.Aexfy.companies;
        if (companies && typeof companies.openCompanyModal === 'function') {
          button.addEventListener('click', function() {
            companies.openCompanyModal(null);
          });
          return true;
        }
        return false;
      }

      function waitForCompanies(attempts) {
        if (bindButton()) return;
        if (attempts <= 0) {
          console.warn('No se pudo enlazar el botÃ³n de crear empresa: componente companies no inicializado.');
          return;
        }
        setTimeout(function() {
          waitForCompanies(attempts - 1);
        }, 200);
      }

      waitForCompanies(15);
    })();
  </script>
</body>
</html>






