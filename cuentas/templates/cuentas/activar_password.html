{% extends "base.html" %}
{% load static %}

{% block title %}Crear contrasena{% endblock %}

{% block nav %}{% endblock %}

{% block extra_js %}
    <!-- Script que valida y envia la contrasena usando Supabase Auth -->
    <script src="{% static 'cuentas/js/activar_password.js' %}"></script>
{% endblock %}

{% block content %}
    <!-- Bloque simple para crear la contrasena desde el link de invitacion de Supabase. -->
    <h1>Crear contrasena</h1>
    <p>
      Usa el enlace recibido en tu correo. Si el enlace expiro, solicita una nueva invitacion.
    </p>

    <div class="card" id="activar-usuario" style="margin-bottom: 16px;">
      <h2>Datos del usuario</h2>
      <p class="card-subtitle">Verifica que correspondan antes de crear la contrasena.</p>
      <dl class="meta-list">
        <div>
          <strong>RUT:</strong> <span id="activar-usuario-rut">--</span>
        </div>
        <div>
          <strong>Nombre:</strong> <span id="activar-usuario-nombre">--</span>
        </div>
        <div>
          <strong>Email:</strong> <span id="activar-usuario-email">--</span>
        </div>
      </dl>
    </div>

    <!-- El formulario se completa en el navegador usando cuentas/static/cuentas/js/activar_password.js. -->
    <form
      id="activar-form"
      class="form-grid"
      data-supabase-url="{{ supabase_url }}"
      data-supabase-anon="{{ supabase_anon_key }}"
      autocomplete="off"
    >
      <div class="form-field">
        <label for="password">Contrasena</label>
        <input id="password" name="password" type="password" required />
      </div>

      <div class="form-field">
        <label for="password_confirm">Confirmar contrasena</label>
        <input id="password_confirm" name="password_confirm" type="password" required />
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn--primario">Guardar contrasena</button>
      </div>
    </form>

    <!-- Mensajes de estado que el JS actualiza segun el resultado. -->
    <p id="activar-mensaje" role="status"></p>

    <p>
      <a href="{% url 'login' %}">Ir al login</a>
    </p>
{% endblock %}
